<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:insert="~{usuario/template_user.html::head}">

</head>
<title th:text="${producto.nombreproducto} + ' | BarberMusicSpa'"></title>
<style>
	#main {
		margin-top: 4em;
	}

	.product-gallery {
		position: relative;
	}

	.product-image {
		border-radius: 10px;
		transition: transform 0.3s;
		cursor: zoom-in;
	}

	.product-image:hover {
		transform: scale(1.02);
	}

	.product-badge {
		position: absolute;
		top: 15px;
		left: 15px;
		z-index: 2;
		font-size: 0.8rem;
	}

	.product-title {
		color: var(--heading-color);
		margin-bottom: 1rem;
		font-weight: 700;
	}

	.product-price {
		font-size: 1.8rem;
		color: var(--accent-color);
		font-weight: 700;
		margin-bottom: 1.5rem;
	}

	.product-description {
		color: color-mix(in srgb, var(--default-color), transparent 20%);
		line-height: 1.6;
		margin-bottom: 1.5rem;
	}

	.quantity-input {
		width: 70px;
		display: inline-block;
		text-align: center;
		padding: 0.375rem 0.5rem;
	}

	.product-meta {
		border-top: 1px solid color-mix(in srgb, var(--default-color), transparent 90%);
		padding-top: 1rem;
		margin-top: 1.5rem;
	}

	.product-meta-item {
		margin-bottom: 0.5rem;
	}

	.btn-add-to-cart {
		padding: 0.75rem 2rem;
		font-weight: 500;
		transition: all 0.3s;
	}

	.related-products {
		margin-top: 4rem;
	}

	.zoom-overlay {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: rgba(0, 0, 0, 0.8);
		z-index: 9999;
		display: flex;
		align-items: center;
		justify-content: center;
		cursor: zoom-out;
	}

	.zoomed-image {
		max-width: 90%;
		max-height: 90%;
		object-fit: contain;
	}

	section {
		padding: 60px 0 0 0;
	}
</style>

<body class="index-page">

	<div th:insert="~{usuario/template_user.html::header}" th:if="${sesion == null}"></div>
	<div th:insert="~{usuario/template_user.html::usuarioCabecera}" th:unless="${sesion == null}"></div>

	<main id="main">
		<!-- ======= Breadcrumbs Section ======= -->
		<section class="breadcrumbs">
			<div class="container">
				<h2 th:text="${producto.nombreproducto}"></h2>
				<ol class="breadcrumb">
					<li class="breadcrumb-item"><a th:href="@{/}">Inicio</a></li>
					<li class="breadcrumb-item"><a th:href="@{/productos}">Productos</a></li>
					<li class="breadcrumb-item active" th:text="${producto.nombreproducto}"></li>
				</ol>
			</div>
		</section><!-- End Breadcrumbs -->

		<!-- ======= Product Detail Section ======= -->
		<section class="inner-page">
			<div class="container">
				<div class="row">
					<!-- Product Gallery -->
					<div class="col-lg-6 mb-4 mb-lg-0">
						<div class="product-gallery">
							<img th:src="@{/images/{img} (img=${producto.imagen})}" th:alt="${producto.nombreproducto}"
								class="product-image img-fluid w-100 shadow-sm" id="productImage"
								onclick="zoomImage(this)">
						</div>
					</div>

					<!-- Product Info -->
					<div class="col-lg-6">
						<form th:action="@{/cart}" method="post" th:if="${sesion != null}">
							<input type="hidden" th:value="${producto.id}" name="id">

							<h1 class="product-title" th:text="${producto.nombreproducto}"></h1>

							<div class="d-flex align-items-center mb-3">
								<div class="product-price"
									th:text="${#strings.concat('$', #numbers.formatDecimal(producto.precio, 0, 'POINT',0, 'POINT'))}">
								</div>

							</div>

							<div class="product-description" th:text="${producto.descripcion}"></div>

							<div class="mb-4">
								<label for="cantidad" class="form-label fw-bold">Cantidad:</label>
								<div class="d-flex align-items-center">
									<input type="number" id="cantidad" name="cantidad"
										class="form-control quantity-input me-3" min="1" th:max="${producto.cantidad}"
										value="1">
									<span class="text-muted small" th:if="${producto.cantidad > 0}"
										th:text="'Disponibles: ' + ${producto.cantidad}"></span>
									<span class="text-danger small" th:unless="${producto.cantidad > 0}">Agotado</span>
								</div>
							</div>

							<button type="submit" class="btn btn-danger btn-add-to-cart mb-3"
								th:disabled="${producto.cantidad <= 0}">
								<i class="bi bi-cart-plus me-2"></i>
								<span th:text="${producto.cantidad > 0 ? 'Añadir al carrito' : 'Agotado'}"></span>
							</button>

							<div class="product-meta">
								<div class="product-meta-item">
									<i class="bi bi-truck me-2"></i> Envío gratis en pedidos superiores a $50.000
								</div>
								<div class="product-meta-item">
									<i class="bi bi-arrow-repeat me-2"></i> Devoluciones fáciles dentro de 30 días
								</div>
								<div class="product-meta-item">
									<i class="bi bi-shield-check me-2"></i> Pago seguro con SSL
								</div>
							</div>
						</form>

						<!-- Guest View -->
						<div th:if="${sesion == null}">
							<h1 class="product-title" th:text="${producto.nombreproducto}"></h1>

							<div class="d-flex align-items-center mb-3">
								<div class="product-price"
									th:text="${#strings.concat('$', #numbers.formatDecimal(producto.precio, 0, 'POINT',0, 'POINT'))}">
								</div>

							</div>

							<div class="product-description" th:text="${producto.descripcion}"></div>

							<div class="alert alert-warning mt-4">
								<i class="bi bi-exclamation-circle me-2"></i>
								Debes <a th:href="@{/usuario/login}" class="alert-link">iniciar sesión</a> para agregar
								productos al carrito
							</div>

							<div class="product-meta">
								<div class="product-meta-item">
									<i class="bi bi-truck me-2"></i> Envío gratis en pedidos superiores a $50.000
								</div>
								<div class="product-meta-item">
									<i class="bi bi-arrow-repeat me-2"></i> Devoluciones fáciles dentro de 30 días
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Related Products -->
				<div class="related-products" th:if="${relatedProducts != null and !relatedProducts.empty}">
					<h3 class="mb-4">Productos relacionados</h3>
					<div class="row">
						<div class="col-md-4 mb-4" th:each="related : ${relatedProducts}">
							<div class="card h-100 shadow-sm border-0">
								<a th:href="@{/producto/} + ${related.id}">
									<img th:src="@{/images/{img} (img=${related.imagen})}" class="card-img-top"
										th:alt="${related.nombreproducto}">
								</a>
								<div class="card-body">
									<h5 class="card-title">
										<a th:href="@{/producto/} + ${related.id}"
											th:text="${related.nombreproducto}"></a>
									</h5>
									<div class="d-flex justify-content-between align-items-center">
										<span class="text-danger fw-bold"
											th:text="${#strings.concat('$', #numbers.formatDecimal(related.precio, 0, 'POINT',0, 'POINT'))}"></span>
										<a th:href="@{/producto/} + ${related.id}"
											class="btn btn-sm btn-outline-danger">Ver</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section><!-- End Product Detail Section -->
	</main>

	<!-- Footer -->
	<div th:insert="~{usuario/template_user.html::footer}"></div>

	<!-- Scroll Top -->
	<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center">
		<i class="bi bi-arrow-up-short"></i>
	</a>

	<!-- Preloader -->
	<div id="preloader"></div>

	<!-- JavaScript Files -->
	<div th:insert="~{usuario/template_user.html::jsFiles}"></div>

	<script>
		// Función para zoom de imagen
		function zoomImage(img) {
			const zoomed = document.createElement('div');
			zoomed.className = 'zoom-overlay';
			zoomed.innerHTML = `<img src="${img.src}" class="zoomed-image" alt="${img.alt}">`;
			zoomed.onclick = function () {document.body.removeChild(this);};
			document.body.appendChild(zoomed);
		}

		// Actualizar disponibilidad al cambiar cantidad
		document.getElementById('cantidad')?.addEventListener('change', function () {
			const max = parseInt(this.getAttribute('max'));
			if (this.value > max) {
				this.value = max;
			}
		});
	</script>

</body>

</html>